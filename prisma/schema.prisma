generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  name              String
  email             String             @unique
  password          String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  profilePicture    String?
  timezone          String?
  preferences       Json?
  googleApiKey      String?
  isAdmin           Boolean            @default(false)
  activities        Activity[]
  activityInstances ActivityInstance[]
  coreValues        CoreValue[]
  friends           Friend[]
  locations         Location[]
  participations    Participation[]

  @@index([email])
}

model Friend {
  id             String          @id @default(cuid())
  userId         String
  name           String
  notes          String?
  group          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  email          String?
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  participations Participation[]

  @@index([userId])
}

model CoreValue {
  id          String          @id @default(cuid())
  userId      String
  name        String
  phoneNumber String?
  description String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  activities  ActivityValue[]
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
  @@index([userId])
}

model Activity {
  id          String             @id @default(cuid())
  userId      String
  name        String
  description String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  instances   ActivityInstance[]
  values      ActivityValue[]

  @@index([userId])
}

model ActivityValue {
  id         String    @id @default(cuid())
  activityId String
  valueId    String
  activity   Activity  @relation(fields: [activityId], references: [id], onDelete: Cascade)
  value      CoreValue @relation(fields: [valueId], references: [id], onDelete: Cascade)

  @@unique([activityId, valueId])
  @@index([activityId])
  @@index([valueId])
}

model ActivityInstance {
  id                  String          @id @default(cuid())
  userId              String
  datetime            DateTime
  location            String?
  activityId          String
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  customTitle         String?
  venue               String?
  address             String?
  city                String?
  state               String?
  zipCode             String?
  detailedDescription String?
  requirements        String?
  contactInfo         String?
  venueType           String?
  priceInfo           String?
  capacity            Int?
  endDate             DateTime?
  isAllDay            Boolean         @default(false)
  locationId          String?
  eventUrl            String?
  hostAttending       Boolean         @default(true)
  allowExternalGuests Boolean         @default(true)
  activity            Activity        @relation(fields: [activityId], references: [id], onDelete: Cascade)
  locationRef         Location?       @relation(fields: [locationId], references: [id])
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  participations      Participation[]
  publicRSVPs         PublicRSVP[]

  @@index([userId])
  @@index([activityId])
  @@index([datetime])
}

model Participation {
  id                 String           @id @default(cuid())
  userId             String
  friendId           String
  activityInstanceId String
  createdAt          DateTime         @default(now())
  activityInstance   ActivityInstance @relation(fields: [activityInstanceId], references: [id], onDelete: Cascade)
  friend             Friend           @relation(fields: [friendId], references: [id], onDelete: Cascade)
  user               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([friendId, activityInstanceId])
  @@index([userId])
  @@index([friendId])
  @@index([activityInstanceId])
}

model PublicRSVP {
  id                 String           @id @default(cuid())
  activityInstanceId String
  name               String
  email              String?
  phone              String?
  message            String?
  createdAt          DateTime         @default(now())
  friendId           String?
  activityInstance   ActivityInstance @relation(fields: [activityInstanceId], references: [id], onDelete: Cascade)

  @@index([activityInstanceId])
  @@index([createdAt])
}

model Location {
  id          String             @id @default(cuid())
  userId      String
  name        String
  type        String             @default("Venue")
  address     String?
  description String?
  website     String?
  imageUrl    String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  events      ActivityInstance[]
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}
